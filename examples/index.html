
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Three.js Layer - Google Maps API</title>
    <style>
      html, body, #map-div {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      .webgl {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
    </style>

    <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="data.json"></script>
    <script src="../src/lib/detector.js"></script>
    <script src="../src/lib/canvaslayer.js"></script>
    <script src="../src/lib/three.js"></script>
    <script src="../src/threejs-layer.js"></script>

    <script>
      var map;
      var canvasLayer;
      var gl;

      var pointProgram;
      var pointArrayBuffer;
      var POINT_COUNT = photos.length;

      var pixelsToWebGLMatrix = new Float32Array(16);
      var mapMatrix = new Float32Array(16);

      function init() {
        // initialize the map
        var mapOptions = {
          zoom: 2,
          center: new google.maps.LatLng(10, 0),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          styles: [
            {
              "stylers": [
                { "invert_lightness": true },
                { "saturation": -100 },
                { "visibility": "on" }
              ]
            },{
              "elementType": "labels",
              "stylers": [
                { "visibility": "off" }
              ]
            },{
              "featureType": "landscape",
              "stylers": [
                { "color": "#000000" }
              ]
            },{
              "featureType": "road",
              "stylers": [
                { "visibility": "off" }
              ]
            },{
              "featureType": "poi",
              "stylers": [
                { "visibility": "off" }
              ]
            },{
              "featureType": "administrative",
              "stylers": [
                { "visibility": "off" }
              ]
            },{
              "featureType": "administrative.country",
              "elementType": "geometry",
              "stylers": [
                { "visibility": "on" }
              ]
            }
          ]
        };
        var mapDiv = document.getElementById('map-div');
        map = new google.maps.Map(mapDiv, mapOptions);

        // initialize the canvasLayer
        var canvasLayerOptions = {
          map: map,
          //resizeHandler: resize,
          animate: false,
          //updateHandler: update
        };

        canvasLayer = new CanvasLayer(canvasLayerOptions);

        initThree();
        return;
      }

    
      function loadData() {
        // this data could be loaded from anywhere, but in this case we'll
        // generate some random x,y coords in a world coordinate bounding box
        var rawData = new Float32Array(2 * POINT_COUNT);
      }

      function update() {

        var mapProjection = map.getProjection();

        // Scale to current zoom (worldCoords * 2^zoom)
        var scale = Math.pow(2, map.zoom);
        scaleMatrix(mapMatrix, scale, scale);

        // translate to current view (vector from topLeft to 0,0)
        var offset = mapProjection.fromLatLngToPoint(canvasLayer.getTopLeft());
        // translateMatrix(mapMatrix, -offset.x, -offset.y);

      }

      document.addEventListener('DOMContentLoaded', init, false);
    </script>


  </head>

  <body>
    <div id="map-div"></div>
  </body>
</html>